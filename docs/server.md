# server.cpp

Создание сервера начинается с создания его сокета:

```cpp
int server_socket = socket(AF_INET, SOCK_STREAM, 0);
```

- `socket()`: системный вызов, который создаёт новый сокет.
  Определён в заголовочном файле `<sys/socket.h>`.
- `AF_INET`: константа, обозначающая семейство адресов _IPv4_.
  Определяет, что сокет будет работать с IPv4-адресами.
- `SOCK_STREAM`: константа, указывающая тип сокета.
  Означает надёжный, ориентированный на соединение потоковый сокет (обычно _TCP_).
- `0`: протокол по умолчанию для заданного типа сокета (в данном случае _TCP_).

Далее необходимо убедиться, что сокет создан без ошибок:

```cpp
if (server_socket == -1) {
  ...
}
```

Здесь мы сравниваем значение дескриптора сокета с `-1`.
В Unix-подобных системах `-1` обычно означает ошибку при создании сокета.

Следующим этапом является настройка адреса сервера:

```cpp
sockaddr_in server_address;
```

- `sockaddr_in`: структура (из заголовочного файла `<netinet/in.h>`),
  которая хранит информацию об интернет адресе (_IPv4_).

После определения заполним поля структуры нулями,
чтобы избежать мусора и корректно их инициализировать:

```cpp
memset(&server_address, 0, sizeof(server_address));
```

- `memset`: функция (из `<string.h>`), заполняющая память значением.
- `&server_address`: указатель на структуру `sockaddr_in`.
- `0`: значение, которым заполняется память (обнуление структуры).
- `sizeof(server_address)`: размер структуры в байтах.

Инициализируем получившуюся структуру своими значениями:

```cpp
server_address.sin_family = AF_INET;
server_address.sin_port = htons(8080);
server_address.sin_addr.s_addr = INADDR_ANY:
```

- `sin_family`: поле структуры, указывающее сещейство адресов.
  `AF_INET` указывает, что используется _IPv4_.
- `sin_port`: поле, хранящее номер порта.
- `htons`: функция, преобразующая `short` из порядка хоста (CPU)
  в сетевой порядок байтов (Big Endian).
- `sin_addr`: поле структуры, хранящее IP-адрес(тип `in_addr`).
- `s_addr`: само значение адреса (32-битное число).
- `INADDR_ANY`: константа (обычно `0`), означающая
  "принимать соединения на всех доступных интерфейсах".

Далее происходит привязка сокета к адресу:

```cpp
if (bind(server_socket, (sockaddr *)&server_address,
         sizeof(server_address)) {
  ...
  return 1;
}
```

- `bind`: системный вызов для привязки сокета к адресу.
  Возвращает `0` при успехе,`-1` при ошибке.

Если `bind` возвращает ненулевое значение (ошибка),
программа завершается с кодом `1`.

После этого запускаем режим ожидания подключений:

```cpp
listen(server_socket, 5);
```

- `5`: размер очереди ожидающих подключений.

При принятии подключения объявляется структура для хранения адреса клиента:

```cpp
sockaddr_in client_address;
socklen_t client_addr_size = sizeof(client_address);
int client_socket =
  accept(server_socket, (sockaddr*)&client_address,
         &client_addr_size);
```
